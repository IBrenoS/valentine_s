{"ast":null,"code":"const WaterRefractionShader = {\n  uniforms: {\n    color: {\n      value: null\n    },\n    time: {\n      value: 0\n    },\n    tDiffuse: {\n      value: null\n    },\n    tDudv: {\n      value: null\n    },\n    textureMatrix: {\n      value: null\n    }\n  },\n  vertexShader: [\"uniform mat4 textureMatrix;\", \"varying vec2 vUv;\", \"varying vec4 vUvRefraction;\", \"void main() {\", \"\tvUv = uv;\", \"\tvUvRefraction = textureMatrix * vec4( position, 1.0 );\", \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\", \"}\"].join(\"\\n\"),\n  fragmentShader: [\"uniform vec3 color;\", \"uniform float time;\", \"uniform sampler2D tDiffuse;\", \"uniform sampler2D tDudv;\", \"varying vec2 vUv;\", \"varying vec4 vUvRefraction;\", \"float blendOverlay( float base, float blend ) {\", \"\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\", \"}\", \"vec3 blendOverlay( vec3 base, vec3 blend ) {\", \"\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );\", \"}\", \"void main() {\", \" float waveStrength = 0.1;\", \" float waveSpeed = 0.03;\",\n  // simple distortion (ripple) via dudv map (see https://www.youtube.com/watch?v=6B7IF6GOu7s)\n  \"\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;\", \"\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );\", \"\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;\",\n  // new uv coords\n  \" vec4 uv = vec4( vUvRefraction );\", \" uv.xy += distortion;\", \"\tvec4 base = texture2DProj( tDiffuse, uv );\", \"\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\", \"}\"].join(\"\\n\")\n};\nexport { WaterRefractionShader };","map":{"version":3,"names":["WaterRefractionShader","uniforms","color","value","time","tDiffuse","tDudv","textureMatrix","vertexShader","join","fragmentShader"],"sources":["D:\\valentines_website\\node_modules\\src\\shaders\\WaterRefractionShader.ts"],"sourcesContent":["export const WaterRefractionShader = {\n  uniforms: {\n    color: {\n      value: null,\n    },\n\n    time: {\n      value: 0,\n    },\n\n    tDiffuse: {\n      value: null,\n    },\n\n    tDudv: {\n      value: null,\n    },\n\n    textureMatrix: {\n      value: null,\n    },\n  },\n\n  vertexShader: [\n    'uniform mat4 textureMatrix;',\n\n    'varying vec2 vUv;',\n    'varying vec4 vUvRefraction;',\n\n    'void main() {',\n\n    '\tvUv = uv;',\n\n    '\tvUvRefraction = textureMatrix * vec4( position, 1.0 );',\n\n    '\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n\n    '}',\n  ].join('\\n'),\n\n  fragmentShader: [\n    'uniform vec3 color;',\n    'uniform float time;',\n    'uniform sampler2D tDiffuse;',\n    'uniform sampler2D tDudv;',\n\n    'varying vec2 vUv;',\n    'varying vec4 vUvRefraction;',\n\n    'float blendOverlay( float base, float blend ) {',\n\n    '\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );',\n\n    '}',\n\n    'vec3 blendOverlay( vec3 base, vec3 blend ) {',\n\n    '\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );',\n\n    '}',\n\n    'void main() {',\n\n    ' float waveStrength = 0.1;',\n    ' float waveSpeed = 0.03;',\n\n    // simple distortion (ripple) via dudv map (see https://www.youtube.com/watch?v=6B7IF6GOu7s)\n\n    '\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;',\n    '\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );',\n    '\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;',\n\n    // new uv coords\n\n    ' vec4 uv = vec4( vUvRefraction );',\n    ' uv.xy += distortion;',\n\n    '\tvec4 base = texture2DProj( tDiffuse, uv );',\n\n    '\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );',\n\n    '}',\n  ].join('\\n'),\n}\n"],"mappings":"AAAO,MAAMA,qBAAA,GAAwB;EACnCC,QAAA,EAAU;IACRC,KAAA,EAAO;MACLC,KAAA,EAAO;IACT;IAEAC,IAAA,EAAM;MACJD,KAAA,EAAO;IACT;IAEAE,QAAA,EAAU;MACRF,KAAA,EAAO;IACT;IAEAG,KAAA,EAAO;MACLH,KAAA,EAAO;IACT;IAEAI,aAAA,EAAe;MACbJ,KAAA,EAAO;IACT;EACF;EAEAK,YAAA,EAAc,CACZ,+BAEA,qBACA,+BAEA,iBAEA,cAEA,2DAEA,8EAEA,KACAC,IAAA,CAAK,IAAI;EAEXC,cAAA,EAAgB,CACd,uBACA,uBACA,+BACA,4BAEA,qBACA,+BAEA,mDAEA,sGAEA,KAEA,gDAEA,qHAEA,KAEA,iBAEA,8BACA;EAAA;EAIA,sGACA,oFACA;EAAA;EAIA,qCACA,yBAEA,+CAEA,iEAEA,KACAD,IAAA,CAAK,IAAI;AACb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}